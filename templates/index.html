<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Digital Diet Planner</title>
    <link rel="stylesheet" href="/static/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<button id="toggle-dark">ðŸŒ™</button>

<div class="container">
    <h1>Digital Diet Recommendation App</h1>

    <form method="POST">
        <input type="number" name="height" placeholder="Height (cm)" required>
        <input type="number" name="weight" placeholder="Weight (kg)" required>

        <select name="goal" required>
            <option value="">Select Goal</option>
            <option value="weight_loss">Weight Loss</option>
            <option value="weight_gain">Weight Gain</option>
            <option value="maintain">Maintain Weight</option>
        </select>

        <button type="submit" class="submit-btn">Get Recommendation</button>
    </form>

    {% if result %}
    <div class="result-box">
        <h2>Your Results</h2>
        <p><b>BMI:</b> {{ result.bmi }}</p>
        <p><b>Daily Calories:</b> {{ result.calories }}</p>
        <p><b>Goal:</b> {{ result.diet }}</p>

        <h3>Recommended Foods</h3>
        <ul>
            {% for item in result.diet_list %}
            <li>{{ item }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    {% if history %}
    <div class="history-box">
        <h2>BMI History</h2>
        <canvas id="bmiChart"></canvas>
    </div>
    {% endif %}
</div>

<!-- DARK MODE LOGIC -->
<script>
document.getElementById("toggle-dark").onclick = function () {
    document.body.classList.toggle("dark");

    if (document.body.classList.contains("dark")) {
        localStorage.setItem("mode", "dark");
    } else {
        localStorage.setItem("mode", "light");
    }
};

if (localStorage.getItem("mode") === "dark") {
    document.body.classList.add("dark");
}
</script>

<!-- CHART JS -->
<script>
const bmiValues = [
    {% for h in history %}
    {{ h[0] }},
    {% endfor %}
];

const dates = [
    {% for h in history %}
    "{{ h[3] }}",
    {% endfor %}
];

new Chart(document.getElementById("bmiChart"), {
    type: "line",
    data: {
        labels: dates.reverse(),
        datasets: [{
            label: "BMI Over Time",
            data: bmiValues.reverse(),
            borderWidth: 3,
            tension: 0.4
        }]
    }
});
</script>

</body>
</html>
